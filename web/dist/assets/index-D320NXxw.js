import{y as D,_ as V,d as L,k as c,l as F,n as N,r as a,c as x,o as w,b as t,z as C,t as f,e as y,a as u,w as p,F as B,f as U,g as O,A as E,M as m,s as W}from"./index-DYc8clNA.js";function j(){return D.get("/api/open/services")}function q(v){return D.post("/api/open/check-cdk",v)}function G(v){return D.post("/api/open/submit",v)}const J={id:"BodyCon"},Q={class:"box",style:{"margin-top":"35px"}},R={style:{"padding-bottom":"10px"}},X={id:"envSelect"},Y={style:{width:"100%"}},Z={style:{"margin-top":"8px"}},ee={style:{"margin-top":"8px","font-size":"16px"}},te={id:"num"},ne={id:"tips"},oe={class:"envInput"},le={style:{"text-align":"center","padding-top":"20px"}},se=L({__name:"HomePage",setup(v){const d=c(!0),i=c(!0),_=c([]),k=c(0),b=c(!1),g=c(""),o=F({is_show:!1,level:"info",show_level:"success",show_title:"Tips",content:""}),n=F({name:0,value:"",remark:"",key:""}),A=async()=>{try{const{data:e}=await j();_.value=e.list||[]}catch{m.error("获取服务列表失败")}const l=localStorage.getItem("cd-key");l&&(n.key=l),d.value=!1,i.value=!1},I=l=>{const e=_.value[l];n.name=l,k.value=e.available_slots||0,o.is_show=e.is_prompt,o.level=e.prompt_level,o.content=e.prompt_content,b.value=e.enable_key,o.level==="info"?(o.show_level="success",o.show_title="Tips"):o.level==="warn"?(o.show_level="warning",o.show_title="Warning"):(o.show_level="error",o.show_title="Error");const r=document.getElementById("notice");r&&(r.innerHTML=o.content)},S=async()=>{i.value=!0;try{const l=_.value[n.name],e={env_id:(l==null?void 0:l.id)||n.name,value:n.value,key:n.key,remarks:n.remark},{data:r}=await G(e);r.success===!0?(m.success(r.message||"提交成功"),n.key&&localStorage.setItem("cd-key",n.key),setTimeout(()=>{n.value=""},1e3)):m.warning(r.message||"提交失败")}catch(l){m.warning(l.message||"提交失败")}i.value=!1},$=async()=>{const l=localStorage.getItem("cd-key");if(l&&l!=="")try{const{data:e}=await q({key:l});e.valid?g.value=`卡密剩余次数:${e.remaining_uses}`:m.warning(e.message||"卡密无效")}catch(e){m.warning(e.message||"卡密检查失败")}};return N(()=>{A(),$()}),(l,e)=>{const r=a("a-option"),H=a("a-select"),P=a("a-alert"),T=a("a-textarea"),h=a("a-input"),K=a("a-button"),M=a("a-form");return w(),x("div",J,[t("div",Q,[t("div",null,[t("p",R,"数据提交    "+f(g.value),1),e[10]||(e[10]=t("hr",null,null,-1)),t("div",X,[t("div",Y,[t("div",Z,[e[3]||(e[3]=y(" 数据名： ",-1)),u(H,{style:{width:"320px"},placeholder:"Please select ...",loading:d.value,onChange:I},{default:p(()=>[(w(!0),x(B,null,U(_.value,(s,z)=>(w(),O(r,{key:s.name,value:z},{default:p(()=>[y(f(s.remarks?s.remarks:s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["loading"])]),e[5]||(e[5]=t("br",null,null,-1)),t("div",ee,[e[4]||(e[4]=y(" 剩余位置：",-1)),t("span",te,f(k.value),1)])])]),C(t("div",ne,[u(P,{type:o.show_level,closable:""},{title:p(()=>[y(f(o.show_title),1)]),default:p(()=>[e[6]||(e[6]=t("div",{class:"notice",id:"notice"},null,-1))]),_:1},8,["type"])],512),[[E,o.is_show]]),t("div",oe,[u(M,{model:n},{default:p(()=>[t("div",null,[u(T,{type:"text",placeholder:"数据值",disabled:i.value,modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=s=>n.value=s),"auto-size":"","allow-clear":""},null,8,["disabled","modelValue"])]),C(t("span",null,[e[7]||(e[7]=t("br",null,null,-1)),u(h,{type:"text",placeholder:"卡密",disabled:i.value,modelValue:n.key,"onUpdate:modelValue":e[1]||(e[1]=s=>n.key=s)},null,8,["disabled","modelValue"])],512),[[E,b.value]]),t("div",null,[e[8]||(e[8]=t("br",null,null,-1)),u(h,{type:"text",placeholder:"备注（可空）",disabled:i.value,modelValue:n.remark,"onUpdate:modelValue":e[2]||(e[2]=s=>n.remark=s)},null,8,["disabled","modelValue"])]),t("div",le,[u(K,{type:"primary",style:{width:"200px"},disabled:i.value||!n.value.trim(),onClick:S},{default:p(()=>[...e[9]||(e[9]=[y("提  交",-1)])]),_:1},8,["disabled"])])]),_:1},8,["model"])])])])])}}}),ae=V(se,[["__scopeId","data-v-743ea940"]]),ue={name:"IndexView",components:{HomePage:ae,FooterCom:W}};function ie(v,d,i,_,k,b){const g=a("HomePage"),o=a("FooterCom");return w(),x(B,null,[t("div",null,[u(g)]),d[0]||(d[0]=t("br",null,null,-1)),d[1]||(d[1]=t("br",null,null,-1)),t("div",null,[u(o)])],64)}const de=V(ue,[["render",ie]]);export{de as default};

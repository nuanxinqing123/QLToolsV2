import{y as z,k as D,l as O,fl as R,h as P,r as i,g as $,o as E,w as o,a as t,e as h,t as A,M as S,c as M,F as I,f as N,_ as j,d as G}from"./index-DYc8clNA.js";import{u as L}from"./loading-CJ9iuUov.js";import{d as H}from"./common-C-0pt3Ra.js";function J(e){return z.get("/api/cdk/list",{params:e})}function Q(e){return z.post("/api/cdk/create",e)}function W(e){return z.post("/api/cdk/create/batch",e)}function X(e){return z.put("/api/cdk/update",e)}function T(e){return z.post("/api/cdk/toggle-status",e)}function q(e){return z.delete(`/api/cdk/${e}`)}const Y={__name:"Create",props:{popData:{type:Object,default:()=>({})},visible:{type:Boolean,default:!1}},emits:["update:visible","updateData"],setup(e,{emit:s}){const{setLoading:b}=L(!0),_=s,C=D(null),c=e,m=D(""),a=O({key:"",count:1,is_enable:!0});R(()=>c.popData,(l,n)=>{l&&(l.id?(m.value="编辑卡密",a.key=l.key||"",a.count=l.count||1,a.is_enable=l.is_enable,a.id=l.id):(m.value="创建卡密",a.key="",a.count=1,a.is_enable=!0,delete a.id))},{immediate:!0});const k=P({get(){return c.visible},set(l){_("update:visible",l)}}),y=()=>{_("update:visible",!1)},w=P(()=>({key:[{required:!0,message:"请输入卡密植"}],count:[{required:!0,message:"请输入使用次数"},{validator:(l,n)=>{l==="0"||l===0?n("使用次数不能等于0"):n()}}]})),f=async()=>{b(!0);try{a.id?(await X({id:a.id,key:a.key,count:a.count,is_enable:a.is_enable}),S.success("编辑成功")):(await Q({key:a.key,count:a.count}),S.success("新增成功")),y(),_("updateData")}catch{}finally{b(!1)}},g=async()=>(await C.value.validate()||await f(),!1);return(l,n)=>{const F=i("a-input"),p=i("a-form-item"),U=i("a-input-number"),K=i("a-switch"),v=i("a-form"),r=i("a-modal");return E(),$(r,{visible:k.value,"onUpdate:visible":n[3]||(n[3]=d=>k.value=d),"on-before-ok":g,"unmount-on-close":"",onCancel:y},{title:o(()=>[h(A(m.value),1)]),default:o(()=>[t(v,{ref_key:"formRef",ref:C,rules:w.value,model:a,"auto-label-width":""},{default:o(()=>[t(p,{field:"key",label:"卡密值","validate-trigger":"blur"},{default:o(()=>[t(F,{modelValue:a.key,"onUpdate:modelValue":n[0]||(n[0]=d=>a.key=d),placeholder:"请输入卡密值"},null,8,["modelValue"])]),_:1}),t(p,{field:"count",label:"使用次数"},{default:o(()=>[t(U,{modelValue:a.count,"onUpdate:modelValue":n[1]||(n[1]=d=>a.count=d),placeholder:"使用次数"},null,8,["modelValue"])]),_:1}),t(p,{field:"is_enable",label:"是否启用"},{default:o(()=>[t(K,{modelValue:a.is_enable,"onUpdate:modelValue":n[2]||(n[2]=d=>a.is_enable=d)},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["visible"])}}},Z={__name:"BatchCreate",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","updateData"],setup(e,{emit:s}){const{setLoading:b}=L(!0),_=s,C=D(null),c=e,m=D("批量新增卡密"),a=O({add_count:10,prefix:"",count:1,is_enable:!0}),k=P({get(){return c.visible},set(l){_("update:visible",l)}}),y=()=>{_("update:visible",!1)},w=P(()=>({prefix:[{required:!0,message:"请输入卡密前缀"}],add_count:[{required:!0,message:"请输入生成数量"},{validator:(l,n)=>{l==="0"||l===0?n("生成数不能等于0"):n()}}],count:[{required:!0,message:"请输入使用次数"},{validator:(l,n)=>{l==="0"||l===0?n("使用次数不能等于0"):n()}}]})),f=async()=>{b(!0);try{const{data:l}=await W({count:a.add_count,use_count:a.count});S.success("新增成功"),y(),_("updateData",l)}catch{}finally{b(!1)}},g=async()=>(await C.value.validate()||await f(),!1);return(l,n)=>{const F=i("a-input-number"),p=i("a-form-item"),U=i("a-input"),K=i("a-switch"),v=i("a-form"),r=i("a-modal");return E(),$(r,{visible:k.value,"onUpdate:visible":n[4]||(n[4]=d=>k.value=d),"on-before-ok":g,"unmount-on-close":"",onCancel:y},{title:o(()=>[h(A(m.value),1)]),default:o(()=>[t(v,{ref_key:"formRef",ref:C,rules:w.value,model:a,"auto-label-width":""},{default:o(()=>[t(p,{field:"add_count",label:"生成数量"},{default:o(()=>[t(F,{modelValue:a.add_count,"onUpdate:modelValue":n[0]||(n[0]=d=>a.add_count=d),placeholder:"生成数量"},null,8,["modelValue"])]),_:1}),t(p,{field:"count",label:"使用次数"},{default:o(()=>[t(F,{modelValue:a.count,"onUpdate:modelValue":n[1]||(n[1]=d=>a.count=d),placeholder:"使用次数"},null,8,["modelValue"])]),_:1}),t(p,{field:"prefix",label:"卡密前缀"},{default:o(()=>[t(U,{modelValue:a.prefix,"onUpdate:modelValue":n[2]||(n[2]=d=>a.prefix=d),placeholder:"请输入卡密前缀"},null,8,["modelValue"])]),_:1}),t(p,{field:"is_enable",label:"是否启用"},{default:o(()=>[t(K,{modelValue:a.is_enable,"onUpdate:modelValue":n[3]||(n[3]=d=>a.is_enable=d)},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["visible"])}}},ee={__name:"Cdkey",props:{listData:{type:Array,default:()=>[]},visible:{type:Boolean,default:!1}},emits:["update:visible","updateData"],setup(e,{emit:s}){const b=s,_=e,C=P({get(){return _.visible},set(k){b("update:visible",k)}}),c=()=>{b("update:visible",!1)},m=async()=>{c()},a=async()=>(await m(),!1);return(k,y)=>{const w=i("a-list-item"),f=i("a-list"),g=i("a-modal");return E(),$(g,{visible:C.value,"onUpdate:visible":y[0]||(y[0]=l=>C.value=l),"on-before-ok":a,"unmount-on-close":"",onCancel:c},{title:o(()=>[...y[1]||(y[1]=[h(" 卡密列表 ",-1)])]),default:o(()=>[t(f,{"max-height":240},{default:o(()=>[(E(!0),M(I,null,N(e.listData,(l,n)=>(E(),$(w,{key:n},{default:o(()=>[h(A(l),1)]),_:2},1024))),128))]),_:1})]),_:1},8,["visible"])}}},x=()=>({number:"",name:"",contentType:"",filterType:"",createdTime:[],status:""}),te=G({components:{Create:Y,Cdkey:ee,BatchCreate:Z},setup(){const{loading:e,setLoading:s}=L(!0),b=D([]),_=D(x()),C={pageSize:20,current:1,total:0,showPageSize:!0,showTotal:!0},c=O({...C}),m=async(u={current:c.current,pageSize:c.pageSize})=>{s(!0);try{const V=await J({page:u.current,page_size:u.pageSize});b.value=V.data.list.map(B=>({...B,created_at:H(B.created_at)})),c.total=V.data.total}catch{}finally{s(!1)}},a=()=>{m({...C,..._.value})},k=u=>{c.current=u,m({...c})},y=u=>{c.current=1,c.pageSize=u,m({...c})};m();const w=()=>{_.value=x()},f=D(!1),g=D(!1),l=D([]),n=u=>{m(),u&&u.keys&&u.keys.length&&(l.value=u.keys,g.value=!0)},F=D(!1),p=D({}),U=u=>{p.value=u,F.value=!0},K=()=>{p.value={},F.value=!0},v=D([]),r=O({type:"checkbox",showCheckedAll:!0,onlyCurrent:!1});return{onPageSizeChange:y,cdkeyData:l,cdkeyVisible:g,batchVisible:f,batchEnable:async()=>{try{for(const u of v.value)await T({id:u,is_enable:!0});n(),S.success("批量启用成功"),v.value=[]}catch{}},batchDisable:async()=>{try{for(const u of v.value)await T({id:u,is_enable:!1});n(),S.success("批量禁用成功"),v.value=[]}catch{}},batchDelete:async()=>{try{for(const u of v.value)await q(u);n(),S.success("批量删除成功"),v.value=[]}catch{}},goDelete:async u=>{try{await q(u.id);const V=b.value.findIndex(B=>B.id===u.id);V!==-1&&(b.value.splice(V,1),c.total-=1),S.success("删除成功")}catch{}},selectedKeys:v,rowSelection:r,openPop:K,popData:p,goEdit:U,updateData:n,visible:F,loading:e,search:a,onPageChange:k,renderData:b,pagination:c,formModel:_,reset:w,handleToggleStatus:async(u,V)=>{const B=!!V;try{await T({id:u.id,is_enable:B}),S.success(B?"启用成功":"禁用成功"),u.is_enable=B}catch{u.is_enable=!B,S.error("操作失败")}}}}}),ae={class:"container"};function ne(e,s,b,_,C,c){const m=i("Create"),a=i("BatchCreate"),k=i("Cdkey"),y=i("Breadcrumb"),w=i("a-divider"),f=i("a-button"),g=i("a-space"),l=i("a-popconfirm"),n=i("a-col"),F=i("a-row"),p=i("a-table-column"),U=i("a-switch"),K=i("a-table"),v=i("a-card");return E(),M("div",ae,[t(m,{visible:e.visible,"onUpdate:visible":s[0]||(s[0]=r=>e.visible=r),"pop-data":e.popData,onUpdateData:e.updateData},null,8,["visible","pop-data","onUpdateData"]),t(a,{visible:e.batchVisible,"onUpdate:visible":s[1]||(s[1]=r=>e.batchVisible=r),onUpdateData:e.updateData},null,8,["visible","onUpdateData"]),t(k,{visible:e.cdkeyVisible,"onUpdate:visible":s[2]||(s[2]=r=>e.cdkeyVisible=r),"list-data":e.cdkeyData},null,8,["visible","list-data"]),t(y,{items:["卡密","查询卡密"]}),t(v,{class:"general-card",title:"列表"},{default:o(()=>[t(w,{style:{"margin-top":"0"}}),t(F,{style:{"margin-bottom":"16px"}},{default:o(()=>[t(n,{span:16},{default:o(()=>[t(g,null,{default:o(()=>[t(f,{type:"primary",onClick:e.openPop},{default:o(()=>[...s[5]||(s[5]=[h(" 新建卡密 ",-1)])]),_:1},8,["onClick"])]),_:1}),t(g,null,{default:o(()=>[t(f,{type:"primary",style:{"margin-left":"8px"},onClick:s[3]||(s[3]=r=>e.batchVisible=!0)},{default:o(()=>[...s[6]||(s[6]=[h(" 批量新建 ",-1)])]),_:1})]),_:1}),t(g,null,{default:o(()=>[t(l,{content:"是否确认删除?",onOk:e.batchDelete},{default:o(()=>[t(f,{type:"primary",status:"danger",disabled:e.selectedKeys.length===0,style:{"margin-left":"8px"}},{default:o(()=>[...s[7]||(s[7]=[h(" 批量删除 ",-1)])]),_:1},8,["disabled"])]),_:1},8,["onOk"])]),_:1}),t(g,null,{default:o(()=>[t(f,{type:"primary",status:"success",disabled:e.selectedKeys.length===0,style:{"margin-left":"8px"},onClick:e.batchEnable},{default:o(()=>[...s[8]||(s[8]=[h(" 批量启用 ",-1)])]),_:1},8,["disabled","onClick"])]),_:1}),t(g,null,{default:o(()=>[t(f,{type:"primary",disabled:e.selectedKeys.length===0,style:{"margin-left":"8px"},onClick:e.batchDisable},{default:o(()=>[...s[9]||(s[9]=[h(" 批量禁用 ",-1)])]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1}),t(K,{selectedKeys:e.selectedKeys,"onUpdate:selectedKeys":s[4]||(s[4]=r=>e.selectedKeys=r),"row-key":"id",loading:e.loading,pagination:e.pagination,data:e.renderData,bordered:!1,"row-selection":e.rowSelection,onPageChange:e.onPageChange,onPageSizeChange:e.onPageSizeChange},{columns:o(()=>[t(p,{title:"ID","data-index":"id"}),t(p,{title:"卡密值","data-index":"key"}),t(p,{title:"使用次数","data-index":"count"}),t(p,{title:"创建时间","data-index":"created_at"}),t(p,{title:"是否启用","data-index":"is_enable"},{cell:o(({record:r})=>[t(U,{"model-value":r.is_enable,onChange:d=>e.handleToggleStatus(r,d)},null,8,["model-value","onChange"])]),_:1}),t(p,{title:"操作","data-index":"operations"},{cell:o(({record:r})=>[t(f,{type:"text",size:"small",onClick:d=>e.goEdit(r)},{default:o(()=>[...s[10]||(s[10]=[h(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(l,{content:"是否确认删除?",onOk:d=>e.goDelete(r)},{default:o(()=>[t(f,{status:"danger",type:"text",size:"small",style:{"margin-left":"8px"}},{default:o(()=>[...s[11]||(s[11]=[h(" 删除 ",-1)])]),_:1})]),_:1},8,["onOk"])]),_:1})]),_:1},8,["selectedKeys","loading","pagination","data","row-selection","onPageChange","onPageSizeChange"])]),_:1})])}const pe=j(te,[["render",ne],["__scopeId","data-v-26632cea"]]);export{pe as default};

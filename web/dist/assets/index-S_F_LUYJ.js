import{k,l as E,fl as A,h as z,r,g as q,o as O,w as l,a as e,e as F,t as L,M as g,_ as M,d as N,c as R}from"./index-DYc8clNA.js";import{u as $}from"./loading-CJ9iuUov.js";import{u as j,a as x,v as G,h as H,p as J,g as Q,b as V,c as K,r as W,t as X}from"./video-vertical-By1XWEVu.js";import{d as Y}from"./common-C-0pt3Ra.js";const Z={__name:"Create",props:{popData:{type:Object,default:()=>({})},visible:{type:Boolean,default:!1}},emits:["update:visible","updateData"],setup(t,{emit:n}){const{setLoading:S}=$(!0),v=n,w=k(null),d=t,f=k(""),a=E({name:"",url:"",client_id:"",client_secret:"",is_enable:!0});A(()=>d.popData,s=>{s&&(s.id?(f.value="编辑面板",a.name=s.name||"",a.url=s.url||"",a.client_id=s.client_id||"",a.client_secret=s.client_secret||"",a.is_enable=s.is_enable,a.id=s.id):(f.value="创建面板",a.name="",a.url="",a.client_id="",a.client_secret="",a.is_enable=!0,delete a.id))},{immediate:!0});const P=z({get(){return d.visible},set(s){v("update:visible",s)}}),c=()=>{v("update:visible",!1)},b=z(()=>({name:[{required:!0,message:"请输入名称"}],url:[{required:!0,message:"请输入连接地址"}],client_id:[{required:!0,message:"请输入Client_ID"}],client_secret:[{required:!0,message:"请输入Client_Secret"}]})),p=async()=>{S(!0);try{a.id?(await j({...a}),g.success("编辑成功")):(await x({...a}),g.success("新增成功")),c(),v("updateData")}catch{}finally{S(!1)}},D=async()=>(await w.value.validate()||await p(),!1);return(s,o)=>{const C=r("a-input"),i=r("a-form-item"),T=r("a-switch"),m=r("a-form"),B=r("a-modal");return O(),q(B,{visible:P.value,"onUpdate:visible":o[5]||(o[5]=_=>P.value=_),"on-before-ok":D,"unmount-on-close":"",onCancel:c},{title:l(()=>[F(L(f.value),1)]),default:l(()=>[e(m,{ref_key:"formRef",ref:w,rules:b.value,model:a,"auto-label-width":""},{default:l(()=>[e(i,{field:"name",label:"名称","validate-trigger":"blur"},{default:l(()=>[e(C,{modelValue:a.name,"onUpdate:modelValue":o[0]||(o[0]=_=>a.name=_),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),e(i,{field:"url",label:"链接地址"},{default:l(()=>[e(C,{modelValue:a.url,"onUpdate:modelValue":o[1]||(o[1]=_=>a.url=_),placeholder:"请输入链接地址"},null,8,["modelValue"])]),_:1}),e(i,{field:"client_id",label:"Client_ID"},{default:l(()=>[e(C,{modelValue:a.client_id,"onUpdate:modelValue":o[2]||(o[2]=_=>a.client_id=_),placeholder:"请输入Client_ID"},null,8,["modelValue"])]),_:1}),e(i,{field:"client_secret",label:"Client_Secret"},{default:l(()=>[e(C,{modelValue:a.client_secret,"onUpdate:modelValue":o[3]||(o[3]=_=>a.client_secret=_),placeholder:"请输入Client_Secret"},null,8,["modelValue"])]),_:1}),e(i,{field:"is_enable",label:"是否启用"},{default:l(()=>[e(T,{modelValue:a.is_enable,"onUpdate:modelValue":o[4]||(o[4]=_=>a.is_enable=_)},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["visible"])}}},U=()=>({number:"",name:"",contentType:"",filterType:"",createdTime:[],status:""}),I=t=>t.length>6?t.slice(0,2)+"***"+t.slice(t.length-2):t.slice(0,t.length-4)+"***",ee=N({components:{Create:Z},setup(){const{loading:t,setLoading:n}=$(!0),S=k([]),v=k(U()),w={pageSize:20,current:1,total:0,showPageSize:!0,showTotal:!0},d=E({...w}),f=async(u={current:d.current,pageSize:d.pageSize})=>{n(!0);try{const{data:h}=await Q({page:u.page||u.current,page_size:u.pageSize||u.pageSize});S.value=h.list.map(y=>({...y,created_at:Y(y.created_at),client_id_str:I(y.client_id),client_secret_str:I(y.client_secret)})),d.total=h.total}catch{}finally{n(!1)}},a=()=>{f({...w,...v.value})},P=u=>{d.current=u,f({...d})},c=u=>{d.current=1,d.pageSize=u,f({...d})};f();const b=()=>{v.value=U()},p=()=>{f()},D=k(!1),s=k({}),o=u=>{s.value=u,D.value=!0},C=()=>{s.value={},D.value=!0},i=k([]),T=E({type:"checkbox",showCheckedAll:!0,onlyCurrent:!1});return{handleToggleStatus:async(u,h)=>{try{const y=!!h;await X({id:u.id,is_enable:y}),u.is_enable=y,g.success(y?"启用成功":"禁用成功")}catch{p()}},refreshTokenFuc:async()=>{try{if(i.value.length===0){g.warning("请先选择需要刷新Token的面板");return}const u=i.value.map(h=>W({id:h}));await Promise.all(u),g.success("批量刷新Token成功"),i.value=[],p()}catch{g.error("刷新Token失败")}},onPageSizeChange:c,batchEnable:async()=>{try{await K(i.value,!0),p(),g.success("批量启用成功"),i.value=[]}catch{}},batchDisable:async()=>{try{await K(i.value,!1),p(),g.success("批量禁用成功"),i.value=[]}catch{}},batchDelete:async()=>{try{await V(i.value),p(),g.success("批量删除成功"),i.value=[]}catch{}},goDelete:async u=>{try{await V([u.id]),p(),g.success("删除成功")}catch{}},selectedKeys:i,rowSelection:T,openPop:C,popData:s,goEdit:o,updateData:p,visible:D,loading:t,search:a,onPageChange:P,renderData:S,pagination:d,formModel:v,reset:b,pictureIcon:J,horizontalVideoIcon:H,verticalVideoIcon:G}}}),te={class:"container"};function ae(t,n,S,v,w,d){const f=r("Create"),a=r("Breadcrumb"),P=r("a-divider"),c=r("a-button"),b=r("a-space"),p=r("a-popconfirm"),D=r("a-col"),s=r("a-row"),o=r("a-table-column"),C=r("a-switch"),i=r("a-table"),T=r("a-card");return O(),R("div",te,[e(f,{visible:t.visible,"onUpdate:visible":n[0]||(n[0]=m=>t.visible=m),"pop-data":t.popData,onUpdateData:t.updateData},null,8,["visible","pop-data","onUpdateData"]),e(a,{items:["面板","查询面板"]}),e(T,{class:"general-card",title:"列表"},{default:l(()=>[e(P,{style:{"margin-top":"0"}}),e(s,{style:{"margin-bottom":"16px"}},{default:l(()=>[e(D,{span:16},{default:l(()=>[e(b,null,{default:l(()=>[e(c,{type:"primary",onClick:t.openPop},{default:l(()=>[...n[2]||(n[2]=[F(" 新建面板 ",-1)])]),_:1},8,["onClick"])]),_:1}),e(b,null,{default:l(()=>[e(p,{content:"是否确认删除?",onOk:t.batchDelete},{default:l(()=>[e(c,{type:"primary",status:"danger",disabled:t.selectedKeys.length===0,style:{"margin-left":"8px"}},{default:l(()=>[...n[3]||(n[3]=[F(" 批量删除 ",-1)])]),_:1},8,["disabled"])]),_:1},8,["onOk"])]),_:1}),e(b,null,{default:l(()=>[e(c,{type:"primary",status:"success",disabled:t.selectedKeys.length===0,style:{"margin-left":"8px"},onClick:t.batchEnable},{default:l(()=>[...n[4]||(n[4]=[F(" 批量启用 ",-1)])]),_:1},8,["disabled","onClick"])]),_:1}),e(b,null,{default:l(()=>[e(c,{type:"primary",disabled:t.selectedKeys.length===0,style:{"margin-left":"8px"},onClick:t.batchDisable},{default:l(()=>[...n[5]||(n[5]=[F(" 批量禁用 ",-1)])]),_:1},8,["disabled","onClick"])]),_:1}),e(b,null,{default:l(()=>[e(c,{type:"primary",style:{"margin-left":"8px"},onClick:t.refreshTokenFuc},{default:l(()=>[...n[6]||(n[6]=[F(" 刷新TOKEN ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),e(i,{selectedKeys:t.selectedKeys,"onUpdate:selectedKeys":n[1]||(n[1]=m=>t.selectedKeys=m),"row-key":"id",loading:t.loading,pagination:t.pagination,data:t.renderData,bordered:!1,"row-selection":t.rowSelection,onPageChange:t.onPageChange,onPageSizeChange:t.onPageSizeChange},{columns:l(()=>[e(o,{title:"ID","data-index":"id"}),e(o,{title:"名称","data-index":"name"}),e(o,{title:"链接地址","data-index":"url"}),e(o,{title:"Client_ID","data-index":"client_id_str"}),e(o,{title:"Client_Secret","data-index":"client_secret_str"}),e(o,{title:"创建时间","data-index":"created_at"}),e(o,{title:"是否启用","data-index":"is_enable"},{cell:l(({record:m})=>[e(C,{"model-value":m.is_enable,onChange:B=>t.handleToggleStatus(m,B)},null,8,["model-value","onChange"])]),_:1}),e(o,{title:"操作","data-index":"operations"},{cell:l(({record:m})=>[e(c,{type:"text",size:"small",onClick:B=>t.goEdit(m)},{default:l(()=>[...n[7]||(n[7]=[F(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(p,{content:"是否确认删除?",onOk:B=>t.goDelete(m)},{default:l(()=>[e(c,{status:"danger",type:"text",size:"small",style:{"margin-left":"8px"}},{default:l(()=>[...n[8]||(n[8]=[F(" 删除 ",-1)])]),_:1})]),_:1},8,["onOk"])]),_:1})]),_:1},8,["selectedKeys","loading","pagination","data","row-selection","onPageChange","onPageSizeChange"])]),_:1})])}const de=M(ee,[["render",ae],["__scopeId","data-v-ac076ed0"]]);export{de as default};
